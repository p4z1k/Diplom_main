# Моя дипломная работа — это практическая разработка информационной системы для КФХ (крестьянско-фермерских хозяйств)

Программное обеспечение для контроля и управления сельскохозяйственными участками. Позволяет просматривать, вносить и корректировать данные о полях и урожае. Кроме того, он поддерживает состояния для полей, позволяя детально настраивать их. Информация хранится в базе данных, использующей SQLite3.

## Функциональные возможности

- Загрузка и отображение карт участков
- Управление списком полей и их характеристиками
- Добавление и редактирование информации о сборе урожая
- Интерактивный интерфейс для взаимодействия с данными
- Состояния для полей и детальная их настройка

## Библиотеки

- Python 3
- PyQt5 для графического интерфейса
- HTML для шаблонов карт
- SQLite3

## Установка и запуск

1. Клонируйте репозиторий или скачайте вручную zip-архив
2. Установите зависимости:
   ```bash
   pip install PyQt5
   ```
   ```bash
   pip install PyQtWebEngine
   ```
3. Запустите приложение, открыв **main.py** через Python-IDLE

## Структура проекта

### main.py
Главный модуль приложения для управления сельскохозяйственными участками.  
**Основные функции:**  
- Интерфейс:
  - Две вкладки: "Участки" (список, карта, история урожая) и "Текущие задачи" (статусы, сроки)
  - Фильтры, сортировка, контекстное меню для участков
- Логика:
  - Добавление/редактирование/удаление участков (PlotWizard)
  - Автоматическое и ручное управление статусами (StatusChecker, StatusManager)
  - Учет урожая (HarvestDialog)
- Интеграция:
  - Работа с картами (MapWidget)
  - Хранение данных (LandPlotManager)
- Зависимости:
  - PyQt5, SQLite (через LandPlotManager)

### control_panel.py
Модуль с панелью управления для работы с участками и урожаем.  
**Функционал:**  
- Рисование участков:
  - Кнопки "Начать рисование" и "Сохранить участок" (активируется после создания)
- Управление урожаем:
  - Кнопки "Добавить сбор" и "История сборов" (активируются при выборе участка)
- Интеграция:
  - Связан с главным окном (MainWindow) для передачи событий (например, сохранение участка или открытие истории)

### harvest_dialog.py
Модуль диалогового окна для добавления/редактирования записей о сборе урожая.  
**Функционал:**  
- Форма ввода данных:
  - Дата сбора (календарь с выбором даты)
  - Культура (выпадающий список с автодополнением, учитывает ранее введенные культуры)
  - Количество (валидация чисел с 2 знаками после запятой)
- Режимы работы:
  - Добавление новой записи
  - Редактирование существующей (передается record)
- Методы:
  - `get_data()` — возвращает введенные данные в виде словаря:
    ```python
    {"date": "2023-01-15", "culture": "Пшеница", "amount": 12.5}
    ```
- Интеграция:
  - Используется в MainWindow при добавлении/редактировании урожая
  - Связан с HarvestManager для сохранения данных в БД

### harvest_manager.py
Модуль управления данными о сборе урожая.  
**Основные функции:**  
- Управление историей сборов:
  - Фильтрация и сортировка записей по дате и культуре
  - Обновление таблицы с историей сборов (`update_harvest_history`)
  - Поддержка редактирования существующих записей
- Работа с данными:
  - Получение списка уникальных культур для участка (`update_culture_filter`)
  - Редактирование записей через диалоговое окно (`edit_harvest_record`)
- Интеграция:
  - Использует HarvestDialog для добавления/редактирования записей
  - Взаимодействует с plot_manager для работы с базой данных
- Особенности реализации:
  - Динамическое обновление данных при изменении фильтров

### land_plots_manager.py
Основной модуль для управления сельскохозяйственными участками и их статусами.  
**Ключевые функции:**  
- Управление участками:
  - Добавление (`add_plot`), обновление (`update_plot`), удаление (`delete_plot`)
  - Получение данных (`get_all_plots`, `get_plot_by_id`)
  - Поддержка фильтрации и сортировки
- Работа с урожаем:
  - Добавление записей о сборе (`add_harvest_record`)
  - Получение истории сборов (`get_harvests_for_plot`)
- Управление статусами:
  - Автоматическое обновление статусов (`update_plot_status`)
  - Цепочка статусов (`get_next_status`)
  - Настройка временных интервалов (`get_status_wait_time`)
- Работа с настройками:
  - Загрузка и сохранение конфигурации статусов (`load_status_settings`, `save_status_settings`)
- Особенности:
  - Интегрируется с DatabaseManager для работы с SQLite

### map_loader.py
Модуль для работы с картами Yandex в PyQt5-приложении.  
**Основные функции:**  
- Загрузка карт:
  - Работа с HTML-шаблонами (`load_template`)
  - Создание временных файлов карт (`create_temp_map`)
  - Инъекция JavaScript кода (`inject_js`)
- Управление ресурсами:
  - Автоматическая очистка временных файлов (`cleanup`)
  - Логирование ошибок (через модуль logging)
- Интеграция:
  - Поддержка Yandex Maps API (требуется API-ключ)
  - Генерация QUrl для отображения в QWebEngineView
- Особенности реализации:
  - Поддержка Qt WebChannel для взаимодействия Python-JS

### map_widget.py
Виджет для работы с Yandex Maps в PyQt5-приложении.  
**Основные функции:**  
- Отображение карты:
  - Инициализация Yandex Maps с API-ключом
  - Поддержка поиска адресов через SearchControl
  - Масштабирование и изменение типа карты
- Работа с полигонами:
  - Рисование новых участков (`toggle_drawing_mode`)
  - Отображение существующих участков (`draw_existing_plot`)
  - Визуализация границ (цветная заливка)
- Интеграция с PyQt5:
  - Двустороннее взаимодействие Python-JS через QWebChannel
  - Класс-мост MapBridge для передачи координат
  - Поддержка отладки через remote debugging (порт 9222)
- Особенности:

  - Интерактивное рисование полигонов с визуальной обратной связью

### plot_wizard.py
Мастер создания/редактирования сельскохозяйственных участков с картографическим интерфейсом.  
**Основные функции:**  
- Форма ввода данных:
  - Основные параметры участка (название, тип, кадастровый номер)
  - Земельные характеристики (категория, разрешенное использование)
  - Сведения о правообладателе
  - Расчет площади (автоматический/ручной)
- Картографический интерфейс:
  - Рисование границ участка (полигоны)
  - Указание точки местоположения
  - Автоматический расчет площади по координатам
  - Визуализация границ на карте
- Расчеты:
  - Преобразование единиц площади (кв.м ↔ га)
  - Формула Гаусса для расчета площади по координатам
- Особенности:
  - Интерактивная карта на базе Yandex Maps
  - Поддержка двух режимов работы с картой (полигон/точка)
  - Автоматический расчет площади при рисовании границ

### plots_list_widget.py
Виджет для отображения и фильтрации списка сельскохозяйственных участков.  
**Основные функции:**  
- Отображение списка:
  - Показывает список участков в QListWidget
  - Поддержка контекстного меню (через CustomContextMenu)
- Фильтрация и сортировка:
  - Поиск по названию (search_edit)
  - Фильтр по типу участка (filter_combo)
  - Сортировка по различным параметрам (sort_combo)
- Интерфейс:
  - Компактная панель фильтров
  - Адаптивный список участков
  - Чистый и понятный UI
- Особенности:
  - Гибкая система фильтрации
  - Поддержка различных вариантов сортировки

### status_dialog.py
Диалоговое окно для настройки последовательности статусов участков и временных интервалов между ними.  
**Основные функции:**  
- Управление статусами:
  - Добавление/удаление статусов
  - Редактирование названий статусов
  - Изменение порядка через drag-and-drop или кнопки
  - Настройка временных интервалов для каждого статуса
- Интерфейс:
  - Две связанные таблицы: последовательность статусов и их временные параметры
  - Управление через кнопки (добавить, удалить, переместить)
  - Поддержка drag-and-drop для изменения порядка
- Интеграция:
  - Получение текущих настроек (get_settings)
  - Загрузка существующих настроек (load_data)
  - Автоматическая синхронизация таблиц
- Особенности:
  - Сохранение временных параметров при изменении порядка
  - Поддержка как ручного редактирования, так и drag-and-drop

### status_manager.py
Модуль управления жизненным циклом статусов сельскохозяйственных участков.  
**Основные функции:**  
- Управление статусами:
  - Автоматический расчет дней до смены статуса (calculate_days_left)
  - Определение состояния задачи (get_task_state)
  - Переход на следующий статус (complete_task)
  - Перезапуск цикла статусов (restart_status_cycle)
- Бизнес-логика:
  - Обработка просроченных задач
  - Управление циклами выращивания культур
  - Автоматическая фиксация урожая при перезапуске цикла
- Интеграция:
  - Работает с plot_manager для доступа к данным
  - Отправляет сигналы об обновлении статусов (status_updated)
- Особенности:
  - Поддержка бессрочных задач
  - Визуализация срочности задач

## ПРОЕКТ ПРОДОЛЖАЕТ РАЗРАБАТЫВАТЬСЯ!

## Автор

Разработано [p4z1k](https://github.com/p4z1k).
